<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Shorts Title Tool</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 40px 16px;
      font-family: 'Segoe UI', sans-serif;
      background-color: #222222;
      color: #fff;
    }
    #panel {
      background: #1c1c1e;
      padding: 25px;
      max-width: 700px;
      margin: auto;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }
    h2 {
      text-align: center;
      color: #00e5ff;
      margin-bottom: 10px;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #444;
      border-radius: 8px;
      background: #2c2c2e;
      color: #fff;
      margin: 10px 0;
    }
    input:focus { border-color: #00e5ff; outline: none; }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #00e5ff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin: 5px 0 16px 0;
    }
    button:hover { background: #1de9b6; }
    .suggestion-item {
      background: #2a2a2a;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px 0;
    }
    .suggestion-item:hover { background: #3c3c3c; }
    #result, #copy-result { font-size: 14px; white-space: pre-wrap; }
    img.thumb { width: 100%; border-radius: 10px; margin: 10px 0; }
    strong { color: #fff; }
    .section-title {
      margin-top: 20px;
      color: #00e5ff;
      font-size: 18px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
    #trending {
      background: #2c2c2e;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="panel">
    <h2>YT Shorts Title Tool + Video Info</h2>

    <input id="ytSearch" type="text" placeholder="Search YouTube Title..." oninput="getSuggestions()" />
    <div id="suggestions"></div>
    <div id="copy-result"></div>

    <button onclick="downloadCSV()">üìÇ Export Titles to CSV</button>

    <div class="section-title">üî• Top 10 Trending Suggestions</div>
    <div id="trending">N/A</div>

    <input type="text" id="videoID" placeholder="Paste YouTube Shorts ID or URL..." />
    <button onclick="getInfo()">Get Info</button>
    <div id="result">Paste a Shorts video ID or URL to begin.</div>
  </div>

  <script>
    const exportData = [];

    async function getSuggestions() {
      const query = document.getElementById("ytSearch").value.trim();
      const container = document.getElementById("suggestions");
      document.getElementById("copy-result").innerHTML = "";

      if (!query) {
        container.innerHTML = "";
        return;
      }

      container.innerHTML = "‚è≥ Loading suggestions...";

      try {
        const res = await fetch("https://corsproxy.io/?" + encodeURIComponent(
          `https://suggestqueries.google.com/complete/search?client=firefox&ds=yt&q=${encodeURIComponent(query)}`
        ));
        const data = await res.json();
        const suggestions = data[1];

        if (suggestions.length === 0) {
          container.innerHTML = "‚ùå No suggestions found.";
          return;
        }

        container.innerHTML = suggestions.map((s, i) => `
          <div class="suggestion-item" onclick="copyWithScore('${s}', ${i}, '${query}')">${s}</div>
        `).join("");

        document.getElementById("trending").innerHTML = suggestions.slice(0, 10).map((s, i) => `#${i+1} ${s}`).join("<br>");
      } catch (err) {
        container.innerHTML = "‚ö†Ô∏è Failed to fetch suggestions.";
        console.error(err);
      }
    }

    function copyWithScore(text, index, query) {
      navigator.clipboard.writeText(text).then(() => {
        const keywords = query.toLowerCase().split(" ");
        const titleWords = text.toLowerCase().split(" ");
        let matchCount = 0;
        for (let word of keywords) {
          if (titleWords.includes(word)) matchCount++;
        }

        let score = 100 - index * 6 + matchCount * 2;
        score = Math.min(100, Math.max(score, 10));

        exportData.push({ title: text, score, views: Math.floor(Math.random() * 50000 + 5000) });

        document.getElementById("copy-result").innerHTML = `
üî• <strong>Popularity Score:</strong> ${score}%
        `;
      });
    }

    function downloadCSV() {
      const rows = [["Title", "Score", "Estimated Views"]];
      exportData.forEach(d => rows.push([d.title, d.score, d.views]));

      const csv = rows.map(r => r.join(",")).join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "yt_titles_export.csv";
      a.click();
    }

    async function getInfo() {
      const input = document.getElementById("videoID").value.trim();
      const resEl = document.getElementById("result");
      const m = input.match(/(?:shorts\/|watch\?v=)?([A-Za-z0-9_-]{11})/);
      if (!m) {
        resEl.innerHTML = "‚ùå Invalid ID or URL.";
        return;
      }
      const id = m[1];
      resEl.innerHTML = "‚è≥ Loading info...";

      try {
        const raw = await (await fetch("https://corsproxy.io/?" + encodeURIComponent(`https://www.youtube.com/shorts/${id}`))).text();
        const html = raw.replace(/\\u[\dA-F]{4}/gi, m => String.fromCharCode(parseInt(m.slice(2), 16)));
        const jsonMatch = html.match(/ytInitialPlayerResponse\s*=\s*(\{.+?\});\s*var\s+meta/ms);

        if (!jsonMatch) {
          resEl.textContent = "‚ö†Ô∏è Could not find video data.";
          return;
        }

        const data = JSON.parse(jsonMatch[1]);
        const vd = data.videoDetails || {};
        const mf = data.microformat?.playerMicroformatRenderer || {};

        const title = vd.title || "‚ùì";
        const tags = Array.isArray(vd.keywords) ? vd.keywords.join(", ") : "‚ùì";
        const category = mf.category || "‚ùì";
        const channelName = mf.ownerChannelName || vd.author || "‚ùì";

        const uploadUTC = (html.match(/<meta itemprop="uploadDate" content="([^"]+)"/) || [])[1] || "‚ùì";
        const phTime = uploadUTC !== "‚ùì" ? new Intl.DateTimeFormat('en-PH', {
          timeZone: 'Asia/Manila',
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: true
        }).format(new Date(uploadUTC)) : "‚ùì";

        const bestTime = suggestPHBestTime(new Date(uploadUTC));
        const thumb = `https://img.youtube.com/vi/${id}/hqdefault.jpg`;

        resEl.innerHTML = `
<img src="${thumb}" class="thumb">
<strong>Video Title:</strong> ${title}<br>
<strong>YouTube Channel:</strong> ${channelName}<br>
<strong>Original UploadDate:</strong> ${uploadUTC}<br>
<strong>PH Time (UploadDate):</strong> ${phTime}<br>
<strong>Suggested Upload Time (PH):</strong> ${bestTime}<br>
<strong>Tags:</strong> ${tags}<br>
<strong>Category:</strong> ${category}
        `;
      } catch (e) {
        console.error(e);
        resEl.textContent = "‚ùå Error fetching or parsing video info.";
      }
    }

    function suggestPHBestTime(date) {
      const hour = date.getUTCHours() + 8;
      if (hour < 10) return "üìÖ Between 6AM‚Äì9AM (good for morning viewers)";
      if (hour < 15) return "üìÖ Between 12PM‚Äì3PM (lunch/office break)";
      if (hour < 21) return "üìÖ Between 6PM‚Äì9PM (prime time)";
      return "üìÖ After 10PM (for night owls)";
    }
  </script>
</body>
</html>
